#!/usr/bin/env python3

"""
Lookup a list of DOI, refs #11958 (#note-9).
"""

import json
import sys
from urllib.parse import quote_plus

import requests

solr = "http://localhost:8983/solr/biblio"

if len(sys.argv) > 1:
    solr = sys.argv[1]

dois = [
    "10.2147/TCRM.S130627",
    "10.1186/s12889-017-4275-y",
    "10.1186/s13326-017-0152-y",
    "10.3389/fpsyg.2017.01955",
    "10.1371/journal.pone.0182156",
    "10.1371/journal.pone.0179496",
    "10.1186/s12888-017-1404-1",
    "10.1186/s12896-017-0329-6",
    "10.1186/s12868-017-0340-9",
    "10.1186/s12883-017-0927-x",
    "10.1186/s12859-017-1823-5",
    "10.1186/s12891-017-1461-0",
    "10.1186/s12885-017-3077-z",
    "10.1186/s12877-017-0429-0",
    "10.1186/s12884-017-1565-4",
    "10.1371/journal.pone.0170989",
    "10.1371/journal.pone.0170303",
    "10.1186/s12014-017-9145-1",
    "10.1038/srep40640",
    "10.1186/s12862-017-1001-4",
    "10.1038/srep40207",
    "10.1097/MD.0000000000008136",
    "10.1186/s12862-017-0967-2",
    "10.1371/journal.pone.0172570",
    "10.1371/journal.pone.0176981",
    "10.1186/s12891-017-1847-z",
    "10.1186/s12879-017-2336-6",
    "10.1371/journal.pone.0183698",
    "10.1186/s12880-017-0201-0",
    "10.1186/s12885-017-3662-1",
    "10.1371/journal.pone.0178943",
    "10.1186/s12917-017-1032-5",
    "10.1186/s13037-016-0119-4",
    "10.3390/ijms18112466",
    "10.1038/srep41705",
    "10.1186/s12877-017-0482-8",
    "10.1186/s12893-017-0253-7",
    "10.1371/journal.pone.0169352",
    "10.1186/s12885-017-3454-7",
    "10.1186/s12899-017-0031-x",
    "10.1186/s12891-017-1823-7",
    "10.1186/s12862-017-0904-4",
    "10.1186/s11671-017-1906-2",
    "10.1186/s13326-017-0147-8",
    "10.1371/journal.pone.0182732",
    "10.1186/s12955-017-0723-8",
    "10.3389/fpsyg.2017.01885",
    "10.1186/s12876-017-0614-9",
    "10.1038/s41598-017-09513-6",
    "10.1186/s13677-017-0082-3",
    "10.1186/s12885-017-3742-2",
    "10.1186/s12870-017-1154-8",
    "10.1038/s41598-017-02831-9",
    "10.1038/s41598-017-02670-8",
    "10.1186/s12891-017-1742-7",
    "10.1186/s13015-017-0113-0",
    "10.1186/s12917-017-1233-y",
    "10.1038/s41598-017-02414-8",
    "10.1186/s12934-017-0701-1",
    "10.1186/s12893-017-0277-z",
    "10.1371/journal.pone.0181540",
    "10.1186/s12893-017-0330-y.",
    "10.1371/journal.pone.0180354",
    "10.1186/s12967-017-1208-6",
    "10.1371/journal.pone.0177753",
    "10.1186/s12967-017-1170-3",
    "10.1371/journal.pone.0174996",
    "10.1186/s12882-017-0589-3",
    "10.1038/s41598-017-05912-x",
    "10.1038/s41598-017-10287-0",
    "10.1371/journal.pone.0185136",
    "10.1186/s12891-017-1855-z",
    "10.1371/journal.pone.0178107",
    "10.1371/journal.pone.0178959",
    "10.1186/s12888-017-1398-8",
    "10.1038/s41598-017-07406-2",
    "10.1186/s12863-017-0571-x.",
    "10.1186/s13037-017-0137-x",
    "10.3389/fpsyg.2017.02015",
    "10.1038/s41598-017-15363-z",
    "10.3389/fphys.2017.00906",
    "10.3389/fvets.2017.00203",
    "10.1371/journal.pone.0184121",
    "10.1038/s41598-017-12401-8",
    "10.1371/journal.pone.0183027",
    "10.1038/s41598-017-14458-x",
    "10.1186/s12944-017-0583-6",
    "10.3389/fpsyg.2017.01758",
    "10.1002/ecs2.1996",
    "10.3390/molecules22101804",
    "10.1038/s41598-017-10356-4",
    "10.3389/fneur.2017.00602",
    "10.3390/rs9111103",
    "10.3389/fped.2017.00246",
    "10.3390/v9110344",
    "10.1371/journal.pone.0186881",
    "10.1371/journal.pone.0186170",
    "10.1371/journal.pone.0186558",
    "10.1371/journal.pone.0187192",
    "10.1038/s41598-017-17005-w",
    # Versions without dots.
    "10.1186/s12863-017-0571-x",
    "10.1186/s12893-017-0330-y",
]


if __name__ == '__main__':
    for doi in dois:
        url = "%s/select?wt=json&q=%s" % (solr, quote_plus('"%s"' % doi))
        r = requests.get(url)
        if r.status_code >= 400:
            raise RuntimeError("%s at %s" % (r.status_code, url))
        resp = json.loads(r.text)
        isils = set()
        for doc in resp['response']['docs']:
            if 'institution' not in doc:
                continue
            isils.update(doc['institution'])
        print("%s\t%s\t%s" % (doi, resp['response']['numFound'], ', '.join(isils)))

# $ bin/11958.py http://0.0.0.0:8085/solr/biblio | csvlook -t -H # 2017-01-15
#
# |-------------------------------+---------+---------------------------------------------------------------------------------------------------------------------------|
# |  column1                      | column2 | column3                                                                                                                   |
# |-------------------------------+---------+---------------------------------------------------------------------------------------------------------------------------|
# |  10.2147/TCRM.S130627         | 1       | DE-14, DE-15, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-Zwi2, DE-82, DE-105                                                    |
# |  10.1186/s12889-017-4275-y    | 2       | DE-L242, DE-27, DE-540, DE-14, DE-15, DE-D161, DE-D117, DE-82, finc, DE-Bn3                                               |
# |  10.1186/s13326-017-0152-y    | 1       | finc                                                                                                                      |
# |  10.3389/fpsyg.2017.01955     | 2       | DE-L242, DE-27, DE-540, DE-14, DE-Zwi2, DE-D161, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-15, DE-D117, DE-82, DE-105, DE-Bn3  |
# |  10.1371/journal.pone.0182156 | 2       | DE-L242, DE-14, DE-540, DE-105, DE-15, DE-D161, DE-27, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-Zwi2, DE-D117, DE-82, DE-Bn3  |
# |  10.1371/journal.pone.0179496 | 2       | DE-L242, DE-27, DE-540, DE-Zi4, DE-14, DE-15, DE-D161, DE-Gla1, DE-Brt1, DE-105, DE-Ch1, DE-Zwi2, DE-D117, DE-82, DE-Bn3  |
# |  10.1186/s12888-017-1404-1    | 1       | finc                                                                                                                      |
# |  10.1186/s12896-017-0329-6    | 1       | finc                                                                                                                      |
# |  10.1186/s12868-017-0340-9    | 1       | finc                                                                                                                      |
# |  10.1186/s12883-017-0927-x    | 1       | finc                                                                                                                      |
# |  10.1186/s12859-017-1823-5    | 1       | finc                                                                                                                      |
# |  10.1186/s12891-017-1461-0    | 1       | finc                                                                                                                      |
# |  10.1186/s12885-017-3077-z    | 1       | finc                                                                                                                      |
# |  10.1186/s12877-017-0429-0    | 1       | finc                                                                                                                      |
# |  10.1186/s12884-017-1565-4    | 1       | finc                                                                                                                      |
# |  10.1371/journal.pone.0170989 | 2       | DE-L242, DE-27, DE-540, DE-14, DE-Zwi2, DE-D161, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-15, DE-D117, DE-82, DE-105, DE-Bn3  |
# |  10.1371/journal.pone.0170303 | 2       | DE-L242, DE-27, DE-540, DE-Zi4, DE-14, DE-15, DE-D161, DE-Gla1, DE-Brt1, DE-105, DE-Ch1, DE-Zwi2, DE-D117, DE-82, DE-Bn3  |
# |  10.1186/s12014-017-9145-1    | 1       | finc                                                                                                                      |
# |  10.1038/srep40640            | 1       | finc                                                                                                                      |
# |  10.1186/s12862-017-1001-4    | 1       | finc                                                                                                                      |
# |  10.1038/srep40207            | 1       | finc                                                                                                                      |
# |  10.1097/MD.0000000000008136  | 1       | DE-14, DE-105, DE-Zwi2, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-15, DE-82                                                    |
# |  10.1186/s12862-017-0967-2    | 1       | finc                                                                                                                      |
# |  10.1371/journal.pone.0172570 | 2       | DE-L242, DE-14, DE-540, DE-105, DE-Zwi2, DE-D161, DE-27, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-15, DE-D117, DE-82, DE-Bn3  |
# |  10.1371/journal.pone.0176981 | 2       | DE-L242, DE-14, DE-540, DE-105, DE-Zwi2, DE-D161, DE-27, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-15, DE-D117, DE-82, DE-Bn3  |
# |  10.1186/s12891-017-1847-z    | 1       | finc                                                                                                                      |
# |  10.1186/s12879-017-2336-6    | 1       | finc                                                                                                                      |
# |  10.1371/journal.pone.0183698 | 2       | DE-L242, DE-27, DE-540, DE-14, DE-15, DE-D161, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-Zwi2, DE-D117, DE-82, DE-105, DE-Bn3  |
# |  10.1186/s12880-017-0201-0    | 1       | finc                                                                                                                      |
# |  10.1186/s12885-017-3662-1    | 1       | finc                                                                                                                      |
# |  10.1371/journal.pone.0178943 | 2       | DE-L242, DE-27, DE-540, DE-Zi4, DE-14, DE-Zwi2, DE-D161, DE-Gla1, DE-Brt1, DE-105, DE-Ch1, DE-15, DE-D117, DE-82, DE-Bn3  |
# |  10.1186/s12917-017-1032-5    | 1       | finc                                                                                                                      |
# |  10.1186/s13037-016-0119-4    | 1       | finc                                                                                                                      |
# |  10.3390/ijms18112466         | 2       | DE-L242, DE-27, DE-540, DE-Zi4, DE-105, DE-Zwi2, DE-D161, DE-Gla1, DE-Brt1, DE-14, DE-Ch1, DE-15, DE-D117, DE-82, DE-Bn3  |
# |  10.1038/srep41705            | 1       | finc                                                                                                                      |
# |  10.1186/s12877-017-0482-8    | 1       | finc                                                                                                                      |
# |  10.1186/s12893-017-0253-7    | 1       | finc                                                                                                                      |
# |  10.1371/journal.pone.0169352 | 1       | DE-105, DE-Zwi2, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-15, DE-82                                                           |
# |  10.1186/s12885-017-3454-7    | 1       | finc                                                                                                                      |
# |  10.1186/s12899-017-0031-x    | 1       | finc                                                                                                                      |
# |  10.1186/s12891-017-1823-7    | 1       | finc                                                                                                                      |
# |  10.1186/s12862-017-0904-4    | 1       | finc                                                                                                                      |
# |  10.1186/s11671-017-1906-2    | 1       | finc                                                                                                                      |
# |  10.1186/s13326-017-0147-8    | 1       | finc                                                                                                                      |
# |  10.1371/journal.pone.0182732 | 2       | DE-L242, DE-14, DE-540, DE-105, DE-15, DE-D161, DE-27, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-Zwi2, DE-D117, DE-82, DE-Bn3  |
# |  10.1186/s12955-017-0723-8    | 1       | finc                                                                                                                      |
# |  10.3389/fpsyg.2017.01885     | 2       | DE-L242, DE-14, DE-540, DE-105, DE-15, DE-D161, DE-27, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-Zwi2, DE-D117, DE-82, DE-Bn3  |
# |  10.1186/s12876-017-0614-9    | 1       | finc                                                                                                                      |
# |  10.1038/s41598-017-09513-6   | 1       | finc                                                                                                                      |
# |  10.1186/s13677-017-0082-3    | 1       | finc                                                                                                                      |
# |  10.1186/s12885-017-3742-2    | 1       | finc                                                                                                                      |
# |  10.1186/s12870-017-1154-8    | 1       | finc                                                                                                                      |
# |  10.1038/s41598-017-02831-9   | 1       | finc                                                                                                                      |
# |  10.1038/s41598-017-02670-8   | 1       | finc                                                                                                                      |
# |  10.1186/s12891-017-1742-7    | 1       | finc                                                                                                                      |
# |  10.1186/s13015-017-0113-0    | 1       | finc                                                                                                                      |
# |  10.1186/s12917-017-1233-y    | 1       | finc                                                                                                                      |
# |  10.1038/s41598-017-02414-8   | 1       | finc                                                                                                                      |
# |  10.1186/s12934-017-0701-1    | 1       | finc                                                                                                                      |
# |  10.1186/s12893-017-0277-z    | 1       | finc                                                                                                                      |
# |  10.1371/journal.pone.0181540 | 2       | DE-L242, DE-27, DE-540, DE-14, DE-Zwi2, DE-D161, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-15, DE-D117, DE-82, DE-105, DE-Bn3  |
# |  10.1186/s12893-017-0330-y.   | 0       |                                                                                                                           |
# |  10.1371/journal.pone.0180354 | 2       | DE-L242, DE-14, DE-540, DE-105, DE-Zwi2, DE-D161, DE-27, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-15, DE-D117, DE-82, DE-Bn3  |
# |  10.1186/s12967-017-1208-6    | 1       | finc                                                                                                                      |
# |  10.1371/journal.pone.0177753 | 2       | DE-L242, DE-14, DE-540, DE-105, DE-Zwi2, DE-D161, DE-27, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-15, DE-D117, DE-82, DE-Bn3  |
# |  10.1186/s12967-017-1170-3    | 1       | finc                                                                                                                      |
# |  10.1371/journal.pone.0174996 | 1       | DE-105, DE-15, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-Zwi2, DE-82                                                           |
# |  10.1186/s12882-017-0589-3    | 1       | finc                                                                                                                      |
# |  10.1038/s41598-017-05912-x   | 1       | finc                                                                                                                      |
# |  10.1038/s41598-017-10287-0   | 1       | finc                                                                                                                      |
# |  10.1371/journal.pone.0185136 | 2       | DE-L242, DE-14, DE-540, DE-105, DE-Zwi2, DE-D161, DE-27, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-15, DE-D117, DE-82, DE-Bn3  |
# |  10.1186/s12891-017-1855-z    | 1       | finc                                                                                                                      |
# |  10.1371/journal.pone.0178107 | 2       | DE-L242, DE-14, DE-540, DE-105, DE-15, DE-D161, DE-27, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-Zwi2, DE-D117, DE-82, DE-Bn3  |
# |  10.1371/journal.pone.0178959 | 2       | DE-L242, DE-14, DE-540, DE-105, DE-15, DE-D161, DE-27, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-Zwi2, DE-D117, DE-82, DE-Bn3  |
# |  10.1186/s12888-017-1398-8    | 1       | finc                                                                                                                      |
# |  10.1038/s41598-017-07406-2   | 1       | finc                                                                                                                      |
# |  10.1186/s12863-017-0571-x.   | 0       |                                                                                                                           |
# |  10.1186/s13037-017-0137-x    | 1       | finc                                                                                                                      |
# |  10.3389/fpsyg.2017.02015     | 2       | DE-L242, DE-14, DE-540, DE-105, DE-Zwi2, DE-D161, DE-27, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-15, DE-D117, DE-82, DE-Bn3  |
# |  10.1038/s41598-017-15363-z   | 1       | finc                                                                                                                      |
# |  10.3389/fphys.2017.00906     | 2       | DE-L242, DE-27, DE-540, DE-Zi4, DE-105, DE-Zwi2, DE-D161, DE-Gla1, DE-Brt1, DE-14, DE-Ch1, DE-15, DE-D117, DE-82, DE-Bn3  |
# |  10.3389/fvets.2017.00203     | 1       | DE-L242, DE-27, DE-540, DE-14, DE-15, DE-D161, DE-D117, DE-82, DE-Bn3                                                     |
# |  10.1371/journal.pone.0184121 | 1       | DE-105, DE-Zwi2, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-15, DE-82                                                           |
# |  10.1038/s41598-017-12401-8   | 1       | finc                                                                                                                      |
# |  10.1371/journal.pone.0183027 | 2       | DE-L242, DE-14, DE-540, DE-105, DE-15, DE-D161, DE-27, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-Zwi2, DE-D117, DE-82, DE-Bn3  |
# |  10.1038/s41598-017-14458-x   | 1       | finc                                                                                                                      |
# |  10.1186/s12944-017-0583-6    | 1       | finc                                                                                                                      |
# |  10.3389/fpsyg.2017.01758     | 2       | DE-L242, DE-27, DE-540, DE-Zi4, DE-105, DE-15, DE-D161, DE-Gla1, DE-Brt1, DE-14, DE-Ch1, DE-Zwi2, DE-D117, DE-82, DE-Bn3  |
# |  10.1002/ecs2.1996            | 1       | DE-14, DE-105, DE-Zwi2, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-15, DE-82                                                    |
# |  10.3390/molecules22101804    | 2       | DE-L242, DE-27, DE-540, DE-14, DE-Zwi2, DE-D161, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-15, DE-D117, DE-82, DE-105, DE-Bn3  |
# |  10.1038/s41598-017-10356-4   | 1       | finc                                                                                                                      |
# |  10.3389/fneur.2017.00602     | 1       | DE-14, DE-Zwi2, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-15, DE-82, DE-105                                                    |
# |  10.3390/rs9111103            | 2       | DE-L242, DE-27, DE-540, DE-Zi4, DE-105, DE-15, DE-D161, DE-Gla1, DE-Brt1, DE-14, DE-Ch1, DE-Zwi2, DE-D117, DE-82, DE-Bn3  |
# |  10.3389/fped.2017.00246      | 2       | DE-L242, DE-27, DE-540, DE-14, DE-Zwi2, DE-D161, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-15, DE-D117, DE-82, DE-105, DE-Bn3  |
# |  10.3390/v9110344             | 2       | DE-L242, DE-27, DE-540, DE-14, DE-15, DE-D161, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-Zwi2, DE-D117, DE-82, DE-105, DE-Bn3  |
# |  10.1371/journal.pone.0186881 | 2       | DE-L242, DE-14, DE-540, DE-105, DE-15, DE-D161, DE-27, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-Zwi2, DE-D117, DE-82, DE-Bn3  |
# |  10.1371/journal.pone.0186170 | 2       | DE-L242, DE-14, DE-540, DE-105, DE-15, DE-D161, DE-27, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-Zwi2, DE-D117, DE-82, DE-Bn3  |
# |  10.1371/journal.pone.0186558 | 1       | DE-105, DE-Zwi2, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-15, DE-82                                                           |
# |  10.1371/journal.pone.0187192 | 2       | DE-L242, DE-14, DE-540, DE-105, DE-15, DE-D161, DE-27, DE-Gla1, DE-Brt1, DE-Zi4, DE-Ch1, DE-Zwi2, DE-D117, DE-82, DE-Bn3  |
# |  10.1038/s41598-017-17005-w   | 1       | finc                                                                                                                      |
# |  10.1186/s12863-017-0571-x    | 0       |                                                                                                                           |
# |  10.1186/s12893-017-0330-y    | 0       |                                                                                                                           |
# |-------------------------------+---------+---------------------------------------------------------------------------------------------------------------------------|
